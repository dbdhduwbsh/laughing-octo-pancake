<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>æç®€é»‘Â·å…¨èƒ½åœ°å›¾</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui, sans-serif;}
html,body{height:100%;overflow:hidden;background:#000;color:#eaeaea;}

.nav{
  display:flex;align-items:center;gap:6px;padding:6px 10px;
  background:#101010;border-bottom:1px solid #222;flex-wrap:wrap;
}
.logo{font-weight:600;color:#fff;font-size:14px;}
.tabs{display:flex;gap:4px;flex:1;min-width:200px;}
.tab{padding:4px 8px;border-radius:6px;border:none;background:#1a1a1a;color:#ccc;font-size:12px;cursor:pointer;}
.tab.active{background:#0077ff;color:#fff;}
.btns{display:flex;gap:4px;}
.btn{padding:4px 8px;border-radius:6px;border:1px solid #333;background:#1a1a1a;color:#ccc;font-size:12px;cursor:pointer;}

.wrap{display:flex;height:calc(100% - 42px);}
.panel{
  width:280px;background:#101010;border-right:1px solid #222;
  padding:8px;display:flex;flex-direction:column;gap:8px;overflow-y:auto;
}
.card{background:#141414;border:1px solid #222;border-radius:8px;padding:8px;}
.card h4{font-size:12px;margin-bottom:6px;color:#aaa;}
input,select{
  width:100%;padding:6px 8px;border-radius:6px;border:1px solid #333;
  background:#1a1a1a;color:#eee;outline:none;font-size:12px;margin-bottom:4px;
}
.action{width:100%;padding:6px;border-radius:6px;background:#0077ff;color:#fff;border:none;font-size:12px;cursor:pointer;}
.route-mode{display:flex;gap:4px;margin-bottom:6px;}
.route-mode button{
  flex:1;padding:4px;border-radius:6px;border:1px solid #333;
  background:#1a1a1a;color:#ccc;font-size:12px;cursor:pointer;
}
.route-mode button.active{background:#0077ff;color:#fff;border-color:#0077ff;}

.map-box{flex:1;position:relative;}
#map{width:100%;height:100%;border:none;}
.full-btn{
  position:absolute;top:8px;right:8px;width:32px;height:32px;
  border-radius:50%;background:#1a1a1a;border:1px solid #333;
  color:#eee;font-size:16px;cursor:pointer;z-index:10;
}

.coord-info{
  position:absolute;bottom:10px;left:10px;background:#111;
  border:1px solid #333;border-radius:6px;padding:6px 10px;
  font-size:12px;color:#ccc;display:flex;align-items:center;gap:8px;z-index:10;
}
#copyCoord{
  padding:2px 6px;background:#1a1a1a;border:1px solid #333;border-radius:4px;color:#ccc;cursor:pointer;font-size:11px;
}

.layer-group{display:flex;gap:4px;margin-bottom:6px;}
.layer-btn{flex:1;padding:4px;border-radius:6px;border:1px solid #333;background:#1a1a1a;color:#ccc;font-size:12px;cursor:pointer;}
.layer-btn.active{background:#0077ff;color:#fff;}

.list{max-height:100px;overflow-y:auto;font-size:12px;color:#ccc;}
.list .item{padding:4px 6px;border-radius:4px;cursor:pointer;}
.list .item:hover{background:#222;}

.clr-bar{display:flex;gap:6px;margin-top:6px;}
.clr-btn{flex:1;padding:4px;border-radius:6px;background:#1a1a1a;color:#aaa;border:1px solid #333;font-size:12px;cursor:pointer;}

@media(max-width:768px){.panel{width:100%;height:260px;}.wrap{flex-direction:column;}}
</style>
</head>

<body>
<div class="nav">
  <div class="logo">æç®€é»‘Â·åœ°å›¾</div>
  <div class="tabs">
    <button class="tab active" data="baidu">ç™¾åº¦</button>
    <button class="tab" data="amap">é«˜å¾·</button>
    <button class="tab" data="qq">è…¾è®¯</button>
    <button class="tab" data="google">è°·æ­Œ</button>
  </div>
  <div class="btns">
    <button class="btn" id="fullBtn">â›¶</button>
    <button class="btn" id="resetBtn">é‡ç½®</button>
  </div>
</div>

<div class="wrap">
  <div class="panel">
    <div class="card">
      <h4>ğŸ” æœç´¢</h4>
      <input type="text" id="kw" placeholder="åœ°ç‚¹">
      <button class="action" id="search">æœç´¢</button>
    </div>

    <div class="card">
      <h4>ğŸ“ å®šä½</h4>
      <button class="action" id="loc">é‡æ–°å®šä½</button>
    </div>

    <div class="card">
      <h4>ğŸ›£ï¸ è·¯çº¿</h4>
      <input type="text" id="from" placeholder="èµ·ç‚¹">
      <input type="text" id="to" placeholder="ç»ˆç‚¹">
      <div class="route-mode">
        <button class="active" data="drive">é©¾è½¦</button>
        <button data="transit">å…¬äº¤</button>
        <button data="walk">æ­¥è¡Œ</button>
      </div>
      <button class="action" id="route">å»è·¯çº¿</button>
    </div>

    <div class="card">
      <h4>ğŸ—ºï¸ å›¾å±‚</h4>
      <div class="layer-group">
        <button class="layer-btn active" data="vec">çŸ¢é‡</button>
        <button class="layer-btn" data="img">å½±åƒ</button>
        <button class="layer-btn" data="ter">åœ°å½¢</button>
      </div>
    </div>

    <div class="card">
      <h4>ğŸ• å†å²</h4>
      <div class="list" id="history"></div>
      <div class="clr-bar">
        <button class="clr-btn" id="clearHistory">æ¸…ç©ºå†å²</button>
      </div>
    </div>

    <div class="card">
      <h4>â­ æ”¶è—</h4>
      <button class="action" id="addFav">æ”¶è—å½“å‰ä½ç½®</button>
      <div class="list" id="fav"></div>
      <div class="clr-bar">
        <button class="clr-btn" id="clearFav">æ¸…ç©ºæ”¶è—</button>
      </div>
    </div>
  </div>

  <div class="map-box">
    <iframe id="map" src="https://map.baidu.com"></iframe>
    <div class="coord-info">
      <span id="coord">åæ ‡ï¼šæ­£åœ¨è‡ªåŠ¨å®šä½â€¦</span>
      <button id="copyCoord">å¤åˆ¶</button>
    </div>
  </div>
</div>

<script>
const map = document.getElementById('map');
const coord = document.getElementById('coord');
const copyCoord = document.getElementById('copyCoord');
const tabs = document.querySelectorAll('.tab');
const layerBtns = document.querySelectorAll('.layer-btn');
const routeBtns = document.querySelectorAll('.route-mode button');

let now = 'baidu';
let layer = 'vec';
let routeType = 'drive';
let currentLat = 0, currentLng = 0;

const url = {
  baidu: 'https://map.baidu.com',
  amap: 'https://amap.com',
  qq: 'https://map.qq.com',
  google: 'https://maps.google.com'
};

// åˆ‡æ¢åœ°å›¾
tabs.forEach(t => {
  t.onclick = () => {
    tabs.forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    now = t.dataset;
    map.src = url[now];
    addHistory(map.src);
  };
});

// å…¨å±
document.getElementById('fullBtn').onclick = () => {
  document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen();
};

// æœç´¢
document.getElementById('search').onclick = () => {
  const k = document.getElementById('kw').value.trim();
  if (!k) return;
  const u = {
    baidu: `https://map.baidu.com/?q=${encodeURIComponent(k)}`,
    amap: `https://ditu.amap.com/search?query=${encodeURIComponent(k)}`,
    qq: `https://map.qq.com/?search=${encodeURIComponent(k)}`,
    google: `https://www.google.com/maps/search/${encodeURIComponent(k)}`
  };
  map.src = u[now];
  addHistory(map.src);
};

// å®šä½å‡½æ•°
function doLocation() {
  if (!navigator.geolocation) {
    coord.innerText = "åæ ‡ï¼šä¸æ”¯æŒå®šä½";
    return;
  }
  navigator.geolocation.getCurrentPosition(p => {
    currentLat = p.coords.latitude;
    currentLng = p.coords.longitude;
    coord.innerText = `WGS84  latï¼š${currentLat.toFixed(6)}  lngï¼š${currentLng.toFixed(6)}`;
    const u = {
      baidu: `https://map.baidu.com/#lat=${currentLat}&lng=${currentLng}&zoom=17`,
      amap: `https://amap.com/?lat=${currentLat}&lng=${currentLng}&zoom=17`,
      qq: `https://map.qq.com/?lat=${currentLat}&lng=${currentLng}&zoom=17`,
      google: `https://maps.google.com/?q=${currentLat},${currentLng}&z=17`
    };
    map.src = u[now];
    addHistory(map.src);
  }, () => coord.innerText = "åæ ‡ï¼šå®šä½å¤±è´¥");
}

// æ‰‹åŠ¨å®šä½
document.getElementById('loc').onclick = doLocation;

// å¤åˆ¶åæ ‡
copyCoord.onclick = () => {
  const text = `${currentLat.toFixed(6)}, ${currentLng.toFixed(6)}`;
  navigator.clipboard.writeText(text).then(() => {
    copyCoord.innerText = "å·²å¤åˆ¶";
    setTimeout(() => copyCoord.innerText = "å¤åˆ¶", 800);
  });
};

// è·¯çº¿
routeBtns.forEach(b => {
  b.onclick = () => {
    routeBtns.forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    routeType = b.dataset;
  };
});
document.getElementById('route').onclick = () => {
  const f = document.getElementById('from').value, t = document.getElementById('to').value;
  if (!f || !t) return;
  const ty = { drive: 'driving', transit: 'transit', walk: 'walking' };
  const u = {
    baidu: `https://map.baidu.com/?sn=${f}&en=${t}&mode=${ty[routeType]}`,
    amap: `https://ditu.amap.com/direction?from=${f}&to=${t}&type=${ty[routeType]}`,
    qq: `https://map.qq.com/route?type=${routeType}&from=${f}&to=${t}`,
    google: `https://www.google.com/maps/dir/${f}/${t}/${ty[routeType]}`
  };
  map.src = u[now];
  addHistory(map.src);
};

// å›¾å±‚
layerBtns.forEach(b => {
  b.onclick = () => {
    layerBtns.forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    layer = b.dataset;
    if (now === 'baidu') map.src = `https://map.baidu.com/#layer=${layer === 'img' ? 'traffic' : 'normal'}`;
    if (now === 'amap') map.src = `https://amap.com/?layer=${layer === 'img' ? 1 : 0}`;
  };
});

// å†å²
function addHistory(uri) {
  let h = JSON.parse(localStorage.his || '[]');
  h = h.filter(i => i !== uri);
  h.unshift(uri);
  if (h.length > 12) h = h.slice(0, 12);
  localStorage.his = JSON.stringify(h);
  renderHistory();
}
function renderHistory() {
  const h = JSON.parse(localStorage.his || '[]');
  document.getElementById('history').innerHTML = h.map(i =>
    `<div class="item" onclick="map.src='${i}'">${i.slice(8, 30)}...</div>`
  ).join('');
}
document.getElementById('clearHistory').onclick = () => {
  localStorage.his = '[]';
  renderHistory();
};

// æ”¶è—
document.getElementById('addFav').onclick = () => {
  let f = JSON.parse(localStorage.fav || '[]');
  const cur = map.src;
  if (!f.includes(cur)) {
    f.unshift(cur);
    localStorage.fav = JSON.stringify(f);
    renderFav();
  }
};
function renderFav() {
  const f = JSON.parse(localStorage.fav || '[]');
  document.getElementById('fav').innerHTML = f.map(i =>
    `<div class="item" onclick="map.src='${i}'">â­ ${i.slice(8, 30)}...</div>`
  ).join('');
}
document.getElementById('clearFav').onclick = () => {
  localStorage.fav = '[]';
  renderFav();
};

// é‡ç½®
document.getElementById('resetBtn').onclick = () => {
  map.src = url[now];
};

// å¼€æœºè‡ªåŠ¨å®šä½
window.onload = () => {
  renderHistory();
  renderFav();
  doLocation();
};
</script>
</body>
</html>
